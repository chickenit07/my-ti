<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved: {{ search_name }} - Threat Intelligence Platform</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='resources/logo.svg') }}">
    <script>
        window.APP_URLS = { savedDetail: '{{ url_for("user.saved_detail_page", saved_search_id=saved_search_id) }}' };
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/saved_detail.css') }}">
    </head>
<body data-theme="dark">
    <div class="container-fluid px-0">
        <!-- Professional Header -->
        <div class="saved-detail-header">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <a href="{{ url_for('user.search') }}">
                        <img src="{{ url_for('static', filename='resources/logo.svg') }}" alt="logo" class="site-logo">
                    </a>
                    <h3 class="header-title"><i class="fas fa-bookmark me-2"></i>Saved Record: <span class="text-primary">{{ search_name }}</span></h3>
                {% if is_admin %}
                <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary btn-sm ms-3"><i class="fas fa-list me-2"></i>Admin Dashboard</a>
                {% else %}
                <a href="{{ url_for('user.saved_page') }}" class="btn btn-secondary btn-sm ms-3"><i class="fas fa-arrow-left me-2"></i>Back To All Saved Records</a>
                {% endif %}
                </div>
                <div class="user-info">
                    <a href="{{ url_for('user.logout') }}" class="btn btn-danger btn-sm"><i class="fas fa-sign-out-alt me-2"></i>Logout</a>
                </div>
            </div>
        </div>

        <div class="results-table">
            <div class="table-responsive">
                <div class="d-flex justify-content-between align-items-center mb-3 px-2 pt-2">
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" onclick="showAddModal()" type="button"><i class="fas fa-plus me-2"></i>Add</button>
                        <button class="btn btn-success" onclick="saveSelectedNotes()" type="button"><i class="fas fa-save me-2"></i>Save</button>
                        <button class="btn btn-danger" onclick="removeSelectedItems()" type="button"><i class="fas fa-trash me-2"></i>Remove</button>
                        <button class="btn btn-info" onclick="showImportModal()" type="button"><i class="fas fa-upload me-2"></i>Import</button>
                        <button class="btn btn-warning" onclick="exportToCSV()" type="button"><i class="fas fa-download me-2"></i>Export</button>
                    </div>
                    <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" onclick="copyAllDomains()" type="button"><i class="fas fa-globe me-2"></i>Copy All Domains</button>
                    <button class="btn btn-outline-primary" onclick="copyAllUsernames()" type="button"><i class="fas fa-users me-2"></i>Copy All Usernames</button>
                    <button class="btn btn-outline-primary" onclick="copyAllPasswords()" type="button"><i class="fas fa-key me-2"></i>Copy All Passwords</button>
                    </div>
                </div>
                <table class="table">
                    <colgroup>
                        <col style="width: 3%">
                        <col style="width: 8%">
                        <col style="width: 15%">
                        <col style="width: 18%">
                        <col style="width: 18%">
                        <col style="width: 2%">
                        <col style="width: 36%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Timestamp</th>
                            <th>Domain</th>
                            <th>Username</th>
                            <th>Password</th>
                            <th>Select</th>
                            <th>Note</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if items %}
                            {% for r in items %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ r.t or r.created_at }}</td>
                                <td><a href="http://{{ r.d }}" target="_blank" class="domain-link">{{ r.d }}</a></td>
                                <td>
                                    <div class="d-flex align-items-center copyable-box">
                                        <span class="me-2 flex-grow-1">{{ r.u }}</span>
                                        <button class="copy-btn" title="Copy username" onclick="event.stopPropagation(); copyToClipboard(this.previousElementSibling.textContent.trim(), this.previousElementSibling);"><i class="fas fa-copy"></i></button>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center copyable-box">
                                        <span class="me-2 flex-grow-1">{{ r.p }}</span>
                                        <button class="copy-btn" title="Copy password" onclick="event.stopPropagation(); copyToClipboard(this.previousElementSibling.textContent.trim(), this.previousElementSibling);"><i class="fas fa-copy"></i></button>
                                    </div>
                                </td>
                                <td>
                                    <div class="form-check d-flex justify-content-center align-items-center" style="min-height: 44px;">
                                        <input type="checkbox" class="form-check-input item-checkbox" value="{{ r.id }}" onchange="updateSelectionCount()" style="width: 1.25rem; height: 1.25rem;">
                                    </div>
                                </td>
                                <td>
                                    <textarea class="form-control note-textarea" data-item-id="{{ r.id }}" rows="2" placeholder="Enter note..." oninput="autoSelectCheckbox(this)">{{ r.note }}</textarea>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="7" class="text-center text-muted py-3">No records in this saved search.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Record Modal -->
    <div class="modal fade" id="addRecordModal" tabindex="-1" aria-labelledby="addRecordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content dark-modal">
                <div class="modal-header dark-modal-header">
                    <h5 class="modal-title" id="addRecordModalLabel">Add New Record</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body dark-modal-body">
                    <form id="addRecordForm">
                        <div class="mb-3">
                            <label for="addDomain" class="form-label">Domain *</label>
                            <input type="text" class="form-control dark-input" id="addDomain" required>
                        </div>
                        <div class="mb-3">
                            <label for="addUsername" class="form-label">Username *</label>
                            <input type="text" class="form-control dark-input" id="addUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="addPassword" class="form-label">Password *</label>
                            <input type="text" class="form-control dark-input" id="addPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="addNote" class="form-label">Note</label>
                            <textarea class="form-control dark-input" id="addNote" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer dark-modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="addRecord()">Add Record</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import CSV Modal -->
    <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content dark-modal">
                <div class="modal-header dark-modal-header">
                    <h5 class="modal-title" id="importModalLabel">Import CSV File</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body dark-modal-body">
                    <div class="mb-3">
                        <label for="csvFile" class="form-label">Select CSV File</label>
                        <input type="file" class="form-control dark-input" id="csvFile" accept=".csv" required>
                        <div class="form-text">CSV format: domain,username,password,note</div>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-outline-info btn-sm" onclick="downloadSampleCSV()">
                            <i class="fas fa-download me-1"></i>Download Sample CSV
                        </button>
                    </div>
                </div>
                <div class="modal-footer dark-modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="importCSV()">Import</button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
        <div class="toast-header">
            <i class="fas fa-check-circle me-2 text-success"></i>
            <strong class="me-auto" id="toast-title">Notice</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toast-body">Copied to clipboard!        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/saved_detail.js') }}"></script>

    
</body>
</html>


